<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Excelå…‰æ ‡æµ‹è¯•</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 900px;
            margin: 0 auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .section {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        canvas { 
            border: 2px solid #ddd; 
            display: block; 
            margin: 10px 0;
            border-radius: 4px;
        }
        .instructions {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .test-list li {
            margin-bottom: 8px;
        }
        .correct { color: #4caf50; font-weight: bold; }
        .incorrect { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Excelå…‰æ ‡è¡Œä¸ºæµ‹è¯•</h1>
        
        <div class="instructions">
            <h3>ğŸ¯ Excelçš„æ­£ç¡®å…‰æ ‡è¡Œä¸º</h3>
            <ul class="test-list">
                <li><span class="correct">åŒå‡»</span> â†’ å…‰æ ‡åœ¨ç‚¹å‡»ä½ç½®ï¼Œ<strong>ä¸å…¨é€‰</strong></li>
                <li><span class="correct">F2</span> â†’ å…‰æ ‡åœ¨æ–‡æœ¬æœ«å°¾ï¼Œä¸å…¨é€‰</li>
                <li><span class="correct">Enter</span> â†’ å…‰æ ‡åœ¨æ–‡æœ¬æœ«å°¾ï¼Œä¸å…¨é€‰</li>
                <li><span class="correct">ç›´æ¥è¾“å…¥</span> â†’ å…¨é€‰æ›¿æ¢åŸæ–‡æœ¬</li>
                <li><span class="correct">Backspace</span> â†’ æ¸…ç©ºåå…‰æ ‡åœ¨å¼€å¤´</li>
            </ul>
        </div>
        
        <div class="comparison">
            <div class="section">
                <h3>âŒ ä¹‹å‰çš„é”™è¯¯è¡Œä¸º</h3>
                <p>åŒå‡» â†’ å…¨é€‰æ–‡æœ¬ï¼ˆé”™è¯¯ï¼‰</p>
                <canvas id="oldCanvas" width="300" height="150"></canvas>
                <p><small>æ¨¡æ‹Ÿï¼šåŒå‡»åæ–‡æœ¬è¢«å…¨é€‰</small></p>
            </div>
            
            <div class="section">
                <h3>âœ… ä¿®æ­£åçš„Excelé£æ ¼</h3>
                <p>åŒå‡» â†’ å…‰æ ‡åœ¨æœ«å°¾ï¼ˆæ­£ç¡®ï¼‰</p>
                <canvas id="newCanvas" width="300" height="150"></canvas>
                <p><small>å®é™…æµ‹è¯•ï¼šåŒå‡»åå…‰æ ‡åœ¨æ–‡æœ¬æœ«å°¾</small></p>
            </div>
        </div>
        
        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 15px;">
            <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li>åœ¨å³ä¾§è¡¨æ ¼ä¸­é€‰æ‹©ä¸€ä¸ªæœ‰æ–‡æœ¬çš„å•å…ƒæ ¼</li>
                <li>åŒå‡»è¯¥å•å…ƒæ ¼</li>
                <li>è§‚å¯Ÿï¼šæ–‡æœ¬æ˜¯å¦è¢«å…¨é€‰ï¼Ÿ</li>
                <li>å¦‚æœåªæœ‰å…‰æ ‡é—ªçƒï¼ˆä¸å…¨é€‰ï¼‰ï¼Œåˆ™è¡Œä¸ºæ­£ç¡®</li>
                <li>å°è¯•F2é”®ï¼Œåº”è¯¥åœ¨æ–‡æœ¬æœ«å°¾æ’å…¥å…‰æ ‡</li>
                <li>å°è¯•ç›´æ¥è¾“å…¥å­—æ¯ï¼Œåº”è¯¥æ›¿æ¢å…¨éƒ¨æ–‡æœ¬</li>
            </ol>
        </div>
    </div>

    <!-- åŠ è½½åŸå§‹æ¨¡å— -->
    <script src="../dataStructures.js"></script>
    <script src="../canvasRenderer.js"></script>
    <script src="../cellEditor.js"></script>
    
    <script>
        // åˆ›å»ºå·¦ä¾§æ¼”ç¤ºï¼ˆæ—§è¡Œä¸ºï¼‰
        function createOldBehaviorDemo() {
            const canvas = document.getElementById('oldCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = '14px Arial';
            ctx.strokeStyle = '#ddd';
            ctx.fillStyle = '#333';
            
            // ç»˜åˆ¶å•å…ƒæ ¼
            ctx.strokeRect(50, 50, 200, 30);
            ctx.fillText('åŒå‡»æˆ‘è¯•è¯•', 60, 70);
            
            // æ·»åŠ è¯´æ˜
            ctx.fillStyle = '#f44336';
            ctx.font = '12px Arial';
            ctx.fillText('æ—§ç‰ˆæœ¬ï¼šåŒå‡»åå…¨é€‰ï¼ˆé”™è¯¯ï¼‰', 50, 100);
            
            // æ¨¡æ‹Ÿå…¨é€‰æ•ˆæœ
            canvas.addEventListener('dblclick', () => {
                ctx.clearRect(50, 50, 200, 30);
                ctx.fillStyle = '#2196f3';
                ctx.fillRect(51, 51, 198, 28);
                ctx.fillStyle = 'white';
                ctx.font = '14px Arial';
                ctx.fillText('åŒå‡»æˆ‘è¯•è¯•', 60, 70);
                
                setTimeout(() => {
                    ctx.clearRect(50, 50, 200, 30);
                    ctx.strokeStyle = '#ddd';
                    ctx.strokeRect(50, 50, 200, 30);
                    ctx.fillStyle = '#333';
                    ctx.fillText('åŒå‡»æˆ‘è¯•è¯•', 60, 70);
                }, 1000);
            });
        }
        
        // åˆ›å»ºå³ä¾§æµ‹è¯•ï¼ˆæ–°è¡Œä¸ºï¼‰
        function createNewBehaviorTest() {
            const data = new TableDataStructures(4, 3);
            
            const testData = [
                ['äº§å“', 'ä»·æ ¼', 'åº“å­˜'],
                ['iPhone', '6999', '50'],
                ['MacBook', '12999', '20']
            ];
            
            // ä¸´æ—¶ç§»é™¤é™åˆ¶åŠ è½½æ•°æ®
            const originalSetCell = data.setCellValue;
            data.setCellValue = function(row, col, value) {
                const stringIndex = this.addString(value);
                const cellIndex = col * this.rows + row;
                this.cellDataView[cellIndex] = stringIndex;
            };
            
            for (let row = 0; row < testData.length; row++) {
                for (let col = 0; col < testData[row].length; col++) {
                    data.setCellValue(row, col, testData[row][col]);
                }
            }
            
            data.currentRowCount = testData.length;
            data.setCellValue = originalSetCell;
            
            const canvas = document.getElementById('newCanvas');
            const renderer = new CanvasTableRenderer(canvas, data);
            const editor = new CellEditor(canvas.parentElement, renderer, data);
            
            // è®¾ç½®å›è°ƒæ¥æ˜¾ç¤ºè¡Œä¸º
            editor.onEditStart = (row, col, value) => {
                console.log(`ç¼–è¾‘å¼€å§‹: (${row}, ${col}) = "${value}"`);
                
                // æ£€æŸ¥è¾“å…¥æ¡†çš„é€‰æ‹©çŠ¶æ€
                setTimeout(() => {
                    const input = document.querySelector('.cell-editor-input');
                    if (input) {
                        const selectionStart = input.selectionStart;
                        const selectionEnd = input.selectionEnd;
                        const isSelected = selectionStart !== selectionEnd;
                        
                        console.log(`å…‰æ ‡ä½ç½®: ${selectionStart}-${selectionEnd}, æ˜¯å¦å…¨é€‰: ${isSelected}`);
                        
                        if (isSelected) {
                            console.log('âŒ æ–‡æœ¬è¢«å…¨é€‰äº†ï¼ˆä¸ç¬¦åˆExcelè¡Œä¸ºï¼‰');
                        } else {
                            console.log('âœ… å…‰æ ‡æ’å…¥ï¼Œæ²¡æœ‰å…¨é€‰ï¼ˆç¬¦åˆExcelè¡Œä¸ºï¼‰');
                        }
                    }
                }, 100);
            };
            
            // åŒå‡»äº‹ä»¶
            canvas.addEventListener('dblclick', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const cell = renderer.getCellFromPosition(x, y);
                
                if (cell.row >= 0 && cell.col >= 0) {
                    console.log('åŒå‡»æ£€æµ‹ï¼Œå¯åŠ¨Excelé£æ ¼ç¼–è¾‘...');
                    editor.startEdit(cell.row, cell.col, '', 'normal');
                }
            });
            
            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', (e) => {
                if (editor.isEditing) return;
                
                const selected = renderer.getSelectedCell();
                if (selected.row < 0 || selected.col < 0) return;
                
                switch (e.key) {
                    case 'F2':
                        console.log('F2é”®æ£€æµ‹ï¼Œå…‰æ ‡åº”è¯¥åœ¨æœ«å°¾...');
                        editor.startEdit(selected.row, selected.col, '', 'append');
                        e.preventDefault();
                        break;
                    default:
                        if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
                            console.log('ç›´æ¥è¾“å…¥æ£€æµ‹ï¼Œåº”è¯¥å…¨é€‰æ›¿æ¢...');
                            editor.startEdit(selected.row, selected.col, e.key, 'replace');
                            e.preventDefault();
                        }
                        break;
                }
            });
            
            // å•å‡»é€‰æ‹©
            renderer.onCellSelected = (row, col) => {
                console.log(`é€‰ä¸­å•å…ƒæ ¼ (${row}, ${col})`);
            };
            
            renderer.render();
        }
        
        // åˆå§‹åŒ–
        createOldBehaviorDemo();
        createNewBehaviorTest();
        
        console.log('ğŸ§ª Excelå…‰æ ‡è¡Œä¸ºæµ‹è¯•å·²å‡†å¤‡å°±ç»ª');
        console.log('åŒå‡»å³ä¾§è¡¨æ ¼ä¸­çš„å•å…ƒæ ¼ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º');
    </script>
</body>
</html>