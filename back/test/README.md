# C++11仓库管理系统 - 安全测试套件

这是一套专门为破坏和攻击C++11仓库管理系统而设计的全面安全测试工具。

## ⚠️ 重要警告

**这些测试程序具有破坏性！**

- 🔥 将尝试各种攻击手段来破坏系统
- 💥 可能导致服务器崩溃或性能下降  
- 🚨 只能在授权的测试环境中使用
- ⚖️ 未经授权的攻击测试是违法的

## 📁 测试程序清单

### 🔨 核心测试程序

1. **`stress_test.cpp`** - 压力测试
   - 高并发HTTP请求（可配置100+线程）
   - 大数据量写入测试
   - 内存使用监控
   - 响应时间分析
   - JSON vs 二进制协议压力测试

2. **`boundary_test.cpp`** - 边界条件测试
   - 整数溢出测试（int32、uint32边界）
   - 字符串长度边界（空字符串到1MB）
   - JSON格式攻击（深度嵌套、格式错误）
   - HTTP协议边界（超长URL、头部）
   - 特殊字符注入（NULL字节、Unicode、XSS）
   - 时间日期边界条件

3. **`concurrent_load_test.cpp`** - 并发负载测试
   - 多线程读写测试
   - 原子计数器并发性能测试
   - 数据一致性验证
   - 竞态条件检测
   - 真实业务场景模拟

### 🛠️ 工具脚本

4. **`compile_tests.sh`** - 一键编译脚本
5. **`run_all_tests.sh`** - 自动化测试运行器

## 🚀 快速开始

### 1. 编译测试程序

```bash
cd /home/tt/616/back/test
./compile_tests.sh
```

### 2. 启动目标系统

确保您的C++11仓库管理系统在端口8080运行：

```bash
cd /home/tt/616/back
# 编译并启动服务器
g++ -std=c++11 -pthread -o warehouse_server main.cpp memory_database.cpp persistence.cpp logger.cpp error_handling.cpp http_server.cpp binary_protocol.cpp monitoring.cpp
./warehouse_server
```

### 3. 运行安全测试

#### 选项A: 运行完整测试套件（推荐）
```bash
./run_all_tests.sh
```

#### 选项B: 单独运行测试
```bash
# 压力测试
./bin/stress_test --threads 100 --requests 1000 --duration 300

# 边界测试  
./bin/boundary_test --host 127.0.0.1 --port 8080

# 并发测试
./bin/concurrent_load_test --readers 20 --writers 10 --duration 180
```

## 📊 测试能力

### 🔍 能够发现的漏洞类型

#### 严重安全漏洞
- **缓冲区溢出**：超长字符串、HTTP头、URL
- **代码注入**：SQL注入风格、命令注入、XSS
- **路径遍历**：访问系统文件（`/etc/passwd`等）
- **内存破坏**：大数据攻击、内存耗尽
- **协议攻击**：HTTP解析漏洞、二进制协议破坏

#### 并发问题
- **竞态条件**：多线程同时写入导致的数据错误
- **原子操作问题**：原子计数器失效
- **死锁检测**：资源争用导致的死锁
- **数据一致性**：并发访问下的数据损坏

#### 性能和稳定性
- **DoS攻击**：连接耗尽、内存炸弹、CPU耗尽
- **慢速攻击**：Slowloris等保持连接攻击
- **资源泄漏**：内存泄漏、文件描述符泄漏
- **性能退化**：高负载下的响应时间恶化

### 🎯 测试参数配置

#### 压力测试参数
```bash
--threads N      # 并发线程数 (默认: 100)
--requests N     # 每线程请求数 (默认: 1000)  
--duration N     # 测试持续时间秒数 (默认: 300)
--size N         # 数据包大小 (默认: 10000)
```

#### 并发测试参数
```bash
--readers N      # 读者线程数 (默认: 20)
--writers N      # 写者线程数 (默认: 10)
--managers N     # Manager数量 (默认: 5)
--duration N     # 测试持续时间 (默认: 180)
```

## 📈 测试报告

测试完成后会生成详细报告，包括：

### 📊 性能指标
- QPS（每秒请求数）
- 响应时间统计（平均、最小、最大、P50/P90/P95/P99）
- 吞吐量（MB/s）
- 成功率和失败率

### 🔍 安全评估
- 发现的漏洞数量和类型
- 服务器崩溃情况
- 内存使用情况
- 并发问题检测结果

### 📝 日志文件
- `test_logs_YYYYMMDD_HHMMSS/` - 测试日志目录
- `boundary_test.log` - 边界测试详细日志
- `stress_test.log` - 压力测试日志
- `concurrent_test.log` - 并发测试日志
- `final_report.txt` - 最终测试报告

## 🛡️ 修复建议

基于测试结果，常见问题的修复建议：

### 输入验证
- 添加字符串长度限制
- 验证数值范围
- 过滤特殊字符和控制字符
- 实现JSON解析安全检查

### 并发控制  
- 检查原子操作的正确性
- 添加适当的互斥锁
- 验证内存屏障的使用
- 实现超时机制

### 资源管理
- 限制并发连接数
- 实现请求大小限制  
- 添加内存使用监控
- 设置操作超时

### 错误处理
- 完善异常处理机制
- 添加优雅降级
- 实现日志记录
- 提供详细错误信息

## 🔬 高级用法

### 自定义攻击测试

您可以修改测试程序来添加特定的攻击向量：

1. **编辑测试源码**：修改`*_test.cpp`文件
2. **添加新攻击**：在相应的测试函数中添加新的攻击逻辑
3. **重新编译**：运行`./compile_tests.sh`
4. **运行测试**：执行更新后的测试

### 性能基准测试

使用不同参数运行多次测试，建立性能基准：

```bash
# 轻负载基准
./bin/stress_test --threads 10 --requests 100 --duration 60

# 中等负载基准  
./bin/stress_test --threads 50 --requests 500 --duration 120

# 重负载基准
./bin/stress_test --threads 200 --requests 2000 --duration 300
```

## ⚖️ 法律声明

这些测试工具仅用于：
- ✅ 授权的安全测试
- ✅ 自己系统的安全评估
- ✅ 教育和研究目的

**严禁用于：**
- ❌ 未经授权的系统攻击
- ❌ 恶意破坏活动
- ❌ 非法渗透测试

使用者需要承担所有法律责任！

## 🤝 贡献

欢迎提交新的攻击向量和测试用例：
1. Fork项目
2. 添加新的测试程序
3. 更新README
4. 提交Pull Request

## 📞 支持

如有问题请：
1. 检查测试日志
2. 查看服务器错误日志
3. 阅读源码注释
4. 提交Issue