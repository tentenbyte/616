# C++11 仓库管理系统安全测试指南

## 概述

本测试套件专门设计用于发现和利用C++11仓库管理系统的安全漏洞。包含了三个主要的攻击测试程序，每个都针对不同类型的安全威胁。

⚠️ **警告：这些工具仅用于安全测试！请确保只在测试环境中运行！**

## 测试程序

### 1. security_attack_test.cpp - 主要安全攻击测试

**攻击类型：**
- **JSON注入攻击**：尝试通过恶意JSON负载破坏解析器
- **缓冲区溢出攻击**：发送超大HTTP头、URL和POST体
- **内存耗尽攻击**：通过大量并发请求和大体积数据耗尽内存
- **路径遍历攻击**：尝试访问系统文件
- **代码注入攻击**：尝试执行系统命令
- **竞态条件攻击**：并发写入测试数据一致性
- **HTTP协议攻击**：发送畸形HTTP请求

**预期发现的漏洞：**
- JSON解析器缓冲区溢出
- 输入验证不足
- 内存管理问题
- 路径验证缺失
- 竞态条件导致的数据不一致

### 2. malicious_client.cpp - 恶意客户端模拟

**攻击类型：**
- **慢速HTTP攻击（Slowloris）**：保持大量慢速连接
- **畸形HTTP请求**：发送各种格式错误的HTTP请求
- **HTTP管道攻击**：发送管道请求测试处理逻辑
- **连接洪水攻击**：快速创建和关闭大量连接
- **随机二进制数据攻击**：发送随机垃圾数据
- **空闲连接攻击**：创建连接但不发送数据
- **分片请求攻击**：将请求分成小片段发送
- **HTTP方法洪水**：使用各种HTTP方法进行攻击

**预期发现的漏洞：**
- 连接处理不当
- HTTP解析器错误
- 资源泄漏
- 协议处理漏洞

### 3. dos_attack_test.cpp - 拒绝服务攻击测试

**攻击类型：**
- **连接耗尽攻击**：创建大量并发连接
- **请求洪水攻击**：高频率发送大量请求
- **内存炸弹攻击**：创建大体积数据记录
- **CPU耗尽攻击**：发送CPU密集型查询
- **慢速查询攻击**：执行复杂的查询操作
- **混合DoS攻击**：同时执行多种攻击

**预期发现的漏洞：**
- 资源限制不足
- 查询优化问题
- 内存管理漏洞
- 并发处理问题

## 使用方法

### 1. 编译测试程序

```bash
cd /home/tt/616/back/test
./compile_security_tests.sh
```

### 2. 启动目标服务器

确保C++11仓库管理系统服务器在端口8080上运行：

```bash
cd /home/tt/616/back
# 编译并运行服务器
cmake . && make && ./warehouse_server
```

### 3. 运行安全测试

#### 运行所有测试（推荐）
```bash
./run_all_attacks.sh
```

#### 单独运行测试
```bash
# 主要安全攻击测试
./bin/security_attack_test

# 恶意客户端攻击
./bin/malicious_client

# 拒绝服务攻击（最危险）
./bin/dos_attack_test
```

#### 指定目标服务器
```bash
./run_all_attacks.sh 192.168.1.100 8080
```

## 攻击检测指标

### 1. 服务器崩溃指标
- 连接被拒绝
- HTTP 500错误
- 无响应
- 进程终止

### 2. 内存问题指标
- 内存使用持续增长
- 内存泄漏
- 堆栈溢出
- 分段错误

### 3. 性能问题指标
- 响应时间急剧增加
- CPU使用率100%
- 系统负载过高
- 连接超时

### 4. 安全漏洞指标
- 路径遍历成功（显示系统文件内容）
- 代码注入成功（执行系统命令）
- 数据一致性问题
- 输入验证绕过

## 测试结果分析

### 成功攻击的标志

#### 🔴 严重漏洞
- 服务器崩溃或挂起
- 系统文件泄露
- 命令执行成功
- 数据一致性破坏

#### 🟡 中等风险
- HTTP 500服务器错误
- 内存使用异常增长
- 响应时间显著增加
- 恶意输入被接受

#### 🟢 良好防护
- HTTP 400错误（正确拒绝）
- 输入验证有效
- 资源限制正常工作
- 错误处理正确

### 常见漏洞和修复建议

#### 1. JSON注入攻击
**症状：** 服务器解析JSON时崩溃或行为异常
**修复：** 
- 使用安全的JSON解析库
- 限制JSON大小
- 验证所有输入字段

#### 2. 缓冲区溢出
**症状：** 处理大数据时崩溃
**修复：**
- 使用标准库容器而不是原始数组
- 检查所有输入长度
- 使用RAII和智能指针

#### 3. 内存耗尽
**症状：** 内存使用无限制增长
**修复：**
- 实现内存使用限制
- 定期清理未使用的数据
- 监控内存使用情况

#### 4. 竞态条件
**症状：** 并发操作导致数据不一致
**修复：**
- 使用原子操作
- 实现适当的锁机制
- 设计无锁数据结构

## 高级攻击场景

### 1. 持续渗透测试
连续运行测试24小时以发现间歇性问题：

```bash
# 循环运行测试
for i in {1..100}; do
    echo "=== 测试轮次 $i ==="
    ./bin/security_attack_test
    sleep 60
done
```

### 2. 压力测试组合
同时运行多个攻击程序：

```bash
# 并行执行
./bin/security_attack_test &
./bin/malicious_client &
./bin/dos_attack_test &
wait
```

### 3. 自定义攻击负载
修改源代码中的攻击参数：
- 增加攻击强度
- 添加新的攻击向量
- 针对特定API端点

## 日志分析

### 服务器日志检查
监控服务器日志中的以下模式：
- 段错误 (Segmentation fault)
- 内存分配失败
- 异常终止
- 错误处理日志

### 系统监控
使用系统工具监控：
```bash
# 内存使用
watch -n 1 'ps aux | grep warehouse_server'

# 网络连接
watch -n 1 'netstat -an | grep :8080'

# 系统负载
watch -n 1 'uptime'
```

## 修复验证

### 1. 回归测试
修复漏洞后重新运行相同的攻击测试

### 2. 性能基准测试
对比修复前后的性能指标

### 3. 代码审查
检查修复是否引入新的安全问题

## 报告模板

### 漏洞报告格式

```
漏洞ID: SEC-2024-001
严重级别: 高/中/低
发现时间: [时间戳]
攻击类型: [具体攻击类型]
影响: [描述影响范围]
复现步骤: [详细步骤]
修复建议: [具体建议]
状态: 待修复/已修复/已验证
```

## 法律声明

⚠️ **重要：这些安全测试工具仅用于授权的安全测试！**

- 仅在您拥有或有明确授权的系统上使用
- 不得用于恶意攻击或未授权访问
- 使用前请确保符合当地法律法规
- 建议在隔离的测试环境中进行

---

**开发者：** 安全测试团队  
**版本：** 1.0  
**更新时间：** 2024年